<!DOCTYPE html><html><head><link rel="stylesheet" href="/main.css"><script src="/themes/highlight/highlight.pack.js" type="text/javascript"></script><script type="text/javascript">hljs.initHighlightingOnLoad();</script></head><body><div id="container" class="markdown-body"><h1>AngularJs controller之间的通信</h1><p>controller之前可以通过事件通信，最近的项目中是通过$rootScope绑定和监听事件，如：</p>
<pre>
<code class="javascript">
// controller A:
...
$rootScope.$emit('eventC', eventData)
...

// controller B:
$rootScope.$on('eventC', function() {...});
</code>
</pre>

<p>开始的时候页面比较少，没有发现问题，后来使用了<code>ngRoute</code>，发现当<code>controller B</code>绑定的页面打开几次后，会同时触发多次<code>eventC</code>，原因就是<code>$rootScope</code>的生命周期是跟随整个app的，而不是某个controller，其绑定的事件当然也不会随某一个controller的销毁而销毁。。。然后<code>controller B</code>被多次调用后<code>$rootScope</code>就被绑定了多个重复的事件</p>
<h2>解决方案：</h2><p>理解了scope的生命周期就好办了，<code>controller B</code>销毁时其scope绑定的事件也会跟着销毁，所以只要把事件绑定到<code>controller B</code>自己的scope上就可以了</p>
<pre>
<code class="javascript">
// controller A:
...
$rootScope.$broadcast('eventC', eventData)
// 注意这里是`$broadcast`而不是`$emit`
...

// controller B:
...
$scope.$on('eventC', function() {...});
...
</code>
</pre></div></body></html>